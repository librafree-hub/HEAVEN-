<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HEAVEN</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="app">
    <!-- サイドバー -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>HEAVEN</h1>
        <p>自動化システム</p>
      </div>
      <ul class="nav-menu">
        <li class="nav-section">メイン</li>
        <li><a href="#" data-page="diary" class="active">写メ日記</a></li>
        <li><a href="#" data-page="mitene">ミテネ</a></li>
        <li class="nav-section">管理</li>
        <li><a href="#" data-page="accounts">アカウント管理</a></li>
        <li><a href="#" data-page="settings">設定</a></li>
      </ul>
    </nav>

    <!-- メインコンテンツ -->
    <main class="content">

      <!-- ===== 写メ日記ページ ===== -->
      <div id="page-diary" class="page active">
        <h2>写メ日記 自動投稿</h2>

        <!-- ステータスパネル -->
        <div class="status-panel">
          <div class="status-panel-item">
            <div class="status-panel-icon" id="diary-live-icon">&#9679;</div>
            <div>
              <div class="status-panel-label">スケジューラー</div>
              <div class="status-panel-value" id="diary-live-status">停止中</div>
            </div>
          </div>
          <div class="status-panel-item">
            <div>
              <div class="status-panel-label">最終投稿</div>
              <div class="status-panel-value" id="diary-last-run">-</div>
            </div>
          </div>
          <div class="status-panel-item">
            <div>
              <div class="status-panel-label">今日の投稿</div>
              <div class="status-panel-value" id="diary-today-count">0 件</div>
            </div>
          </div>
          <div class="status-panel-item">
            <div>
              <div class="status-panel-label">成功 / 失敗</div>
              <div class="status-panel-value" id="diary-today-result">0 / 0</div>
            </div>
          </div>
        </div>

        <!-- 操作ボタン -->
        <div class="action-bar">
          <button class="btn btn-primary btn-lg" onclick="App.postAll()">全アカウント投稿</button>
          <button class="btn btn-secondary" id="btn-diary-scheduler" onclick="App.toggleScheduler()">スケジューラー開始</button>
          <span id="diary-scheduler-status" class="status-badge">停止中</span>
        </div>

        <!-- アカウント別操作 -->
        <div class="card">
          <h3>アカウント別 投稿</h3>
          <div id="diary-accounts-list">読み込み中...</div>
        </div>

        <!-- 投稿履歴 -->
        <div class="card">
          <h3>投稿履歴</h3>
          <div id="diary-history">読み込み中...</div>
        </div>
      </div>

      <!-- ===== ミテネページ ===== -->
      <div id="page-mitene" class="page">
        <h2>ミテネ（旧キテネ）自動送信</h2>

        <!-- ステータスパネル -->
        <div class="status-panel">
          <div class="status-panel-item">
            <div class="status-panel-icon mitene-color" id="mitene-live-icon">&#9679;</div>
            <div>
              <div class="status-panel-label">スケジューラー</div>
              <div class="status-panel-value" id="mitene-live-status">停止中</div>
            </div>
          </div>
          <div class="status-panel-item">
            <div>
              <div class="status-panel-label">今日のミテネ</div>
              <div class="status-panel-value" id="mitene-today-count">0 回</div>
            </div>
          </div>
        </div>

        <!-- 操作ボタン -->
        <div class="action-bar">
          <button class="btn btn-mitene btn-lg" onclick="App.miteneAll()">全アカウント ミテネ送信</button>
          <button class="btn btn-secondary" id="btn-mitene-scheduler" onclick="App.toggleMiteneScheduler()">スケジューラー開始</button>
          <span id="mitene-scheduler-status" class="status-badge">停止中</span>
        </div>

        <!-- アカウント管理（ミテネ専用） -->
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
            <h3 style="margin-bottom:0;">ミテネ アカウント</h3>
            <button class="btn btn-sm btn-mitene" onclick="App.showAddMiteneAccount()">+ 追加</button>
          </div>
          <div id="mitene-accounts-list">読み込み中...</div>
        </div>

        <!-- 使い方ガイド -->
        <div class="card mitene-guide">
          <h3>使い方</h3>
          <div class="guide-steps">
            <div class="guide-step">
              <span class="guide-num">1</span>
              <div>
                <strong>アカウント追加</strong>
                <p>上の「+ 追加」で女の子のログイン情報と送信時刻を設定</p>
              </div>
            </div>
            <div class="guide-step">
              <span class="guide-num">2</span>
              <div>
                <strong>手動テスト</strong>
                <p>アカウント横の「ミテネ送信」をクリック。コンソールログで動作確認</p>
              </div>
            </div>
            <div class="guide-step">
              <span class="guide-num">3</span>
              <div>
                <strong>自動化</strong>
                <p>「スケジューラー開始」で各アカウントの設定時刻に毎日自動送信（10件ずつ）</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 送信履歴 -->
        <div class="card">
          <h3>ミテネ送信履歴</h3>
          <div id="mitene-history">読み込み中...</div>
        </div>
      </div>

      <!-- ミテネアカウント編集モーダル -->
      <div id="modal-mitene-account" class="modal" style="display:none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="modal-mitene-title">ミテネアカウント追加</h3>
            <button class="btn-close" onclick="App.closeModal('modal-mitene-account')">&times;</button>
          </div>
          <form id="form-mitene-account" onsubmit="App.saveMiteneAccount(event)">
            <input type="hidden" id="mitene-acc-id">

            <div class="form-group">
              <label>名前（女の子の名前）</label>
              <input type="text" id="mitene-acc-name" required placeholder="りな">
            </div>

            <hr>
            <h4>姫デコ ログイン情報</h4>

            <div class="form-group">
              <label>ログインURL</label>
              <input type="text" id="mitene-acc-loginUrl" placeholder="https://spgirl.cityheaven.net/J1Login.php">
              <small>空欄の場合はデフォルトURLを使用</small>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>ログインID</label>
                <input type="text" id="mitene-acc-loginId" required>
              </div>
              <div class="form-group">
                <label>パスワード</label>
                <input type="password" id="mitene-acc-loginPassword">
              </div>
            </div>

            <hr>
            <h4>スケジュール</h4>

            <div class="form-group">
              <label>毎日の送信時刻</label>
              <input type="time" id="mitene-acc-schedule" value="10:00">
              <small>スケジューラーON時、この時刻に自動でミテネを10件送信します</small>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-mitene">保存</button>
              <button type="button" class="btn btn-secondary" onclick="App.closeModal('modal-mitene-account')">キャンセル</button>
            </div>
          </form>
        </div>
      </div>

      <!-- ===== アカウント管理ページ ===== -->
      <div id="page-accounts" class="page">
        <h2>アカウント管理</h2>

        <button class="btn btn-primary" onclick="App.showAddAccount()">+ アカウント追加</button>

        <div id="accounts-list" class="accounts-grid">読み込み中...</div>

        <!-- アカウント編集モーダル -->
        <div id="modal-account" class="modal" style="display:none;">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="modal-account-title">アカウント編集</h3>
              <button class="btn-close" onclick="App.closeModal('modal-account')">&times;</button>
            </div>
            <form id="form-account" onsubmit="App.saveAccount(event)">
              <input type="hidden" id="acc-id">

              <div class="form-grid">
                <div class="form-group">
                  <label>名前</label>
                  <input type="text" id="acc-name" required placeholder="りな">
                </div>
                <div class="form-group">
                  <label>1日の投稿数</label>
                  <input type="number" id="acc-postsPerDay" value="3" min="1" max="10">
                </div>
              </div>

              <div class="form-group">
                <label>性格</label>
                <input type="text" id="acc-personality" placeholder="明るくお茶目、アクティブなライフスタイル">
              </div>
              <div class="form-group">
                <label>口調</label>
                <input type="text" id="acc-tone" placeholder="フレンドリーで絵文字多め♪">
              </div>
              <div class="form-group">
                <label>趣味・興味（カンマ区切り）</label>
                <input type="text" id="acc-interests" placeholder="カフェ, ショッピング, 美容">
              </div>
              <div class="form-group">
                <label>文体</label>
                <input type="text" id="acc-writingStyle" placeholder="短文でテンポよく、明るい印象">
              </div>

              <hr>
              <h4>シティヘブン ログイン情報</h4>

              <div class="form-group">
                <label>ログインURL</label>
                <input type="text" id="acc-loginUrl" placeholder="https://d-heaven.net/">
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>ログインID</label>
                  <input type="text" id="acc-loginId">
                </div>
                <div class="form-group">
                  <label>パスワード</label>
                  <input type="password" id="acc-loginPassword">
                </div>
              </div>
              <div class="form-group">
                <label>日記投稿URL</label>
                <input type="text" id="acc-diaryUrl" placeholder="https://spgirl.cityheaven.net/J4KeitaiDiaryPost.php?gid=...">
              </div>
              <hr>
              <h4>投稿オプション</h4>

              <div class="form-grid">
                <div class="form-group">
                  <label>投稿方法</label>
                  <select id="acc-postType">
                    <option value="diary">写メ日記</option>
                    <option value="freepost">フリーポスト（24時間で消える）</option>
                    <option value="random">ランダム（毎回どちらかを自動選択）</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>公開範囲</label>
                  <select id="acc-visibility">
                    <option value="public">全公開</option>
                    <option value="mygirl">マイガール限定</option>
                    <option value="random">ランダム（毎回どちらかを自動選択）</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="button" class="btn btn-secondary" onclick="App.closeModal('modal-account')">キャンセル</button>
              </div>
            </form>
          </div>
        </div>

        <!-- 画像管理モーダル -->
        <div id="modal-images" class="modal" style="display:none;">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="modal-images-title">画像管理</h3>
              <button class="btn-close" onclick="App.closeModal('modal-images')">&times;</button>
            </div>
            <div class="image-upload-area">
              <input type="file" id="image-upload" multiple accept="image/*" onchange="App.uploadImages(event)">
              <label for="image-upload" class="upload-label">画像をドラッグ＆ドロップ または クリックして選択</label>
            </div>
            <div id="image-list" class="image-grid"></div>
          </div>
        </div>
      </div>

      <!-- ===== 設定ページ ===== -->
      <div id="page-settings" class="page">
        <h2>設定</h2>

        <form id="form-settings" onsubmit="App.saveSettings(event)">
          <div class="card">
            <h3>写メ日記 設定</h3>
            <div class="form-group">
              <label class="toggle-label">
                <input type="checkbox" id="set-postingEnabled">
                <span>実際にシティヘブンに投稿する</span>
              </label>
              <small>OFFの場合、日記生成のみ行い投稿はスキップします（テストモード）</small>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>最小文字数</label>
                <input type="number" id="set-minChars" value="450">
              </div>
              <div class="form-group">
                <label>最大文字数</label>
                <input type="number" id="set-maxChars" value="1000">
              </div>
            </div>
            <div class="form-group">
              <label>スケジュール Cron式</label>
              <input type="text" id="set-schedule" value="0 */3 8-23 * * *">
              <small>デフォルト: 8時〜23時の間、3時間ごと</small>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>デフォルト投稿方法</label>
                <select id="set-postType">
                  <option value="diary">写メ日記</option>
                  <option value="freepost">フリーポスト</option>
                  <option value="random">ランダム</option>
                </select>
              </div>
              <div class="form-group">
                <label>デフォルト公開範囲</label>
                <select id="set-visibility">
                  <option value="public">全公開</option>
                  <option value="mygirl">マイガール限定</option>
                  <option value="random">ランダム</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>ミテネ 設定</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>1回の最大送信数</label>
                <input type="number" id="set-miteneMaxSends" value="10" min="1" max="10">
                <small>1回の実行で送る最大人数（上限10）</small>
              </div>
              <div class="form-group">
                <label>送付済みスキップ（週間）</label>
                <input type="number" id="set-miteneMinWeeks" value="0" min="0">
                <small>0 = 制限なし / 例: 2 = 2週間以内に送った人はスキップ</small>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">設定を保存</button>
        </form>
      </div>
    </main>
  </div>

  <script src="/js/app.js"></script>
</body>
</html>
